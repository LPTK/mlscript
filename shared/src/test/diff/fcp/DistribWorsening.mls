:NoRecursiveTypes
:DistributeForalls
:NoJS


// * Test that exposes worseining of type inference due to eager distributivity
// * (compared to no distributivity at all)



type BTB = forall 'b. 'b -> 'b
//│ Defined type alias BTB



// * OK
(fun g -> fun x -> x) : anything -> BTB
//│ res: anything -> BTB


// * OK
def test f =
  f id : anything -> BTB
test (fun g -> fun n -> id)
//│ test: ((forall 'a. 'a -> 'a) -> anything -> BTB) -> anything -> BTB
//│ res: anything -> BTB


// * OK
def test f =
  (fun a -> a : anything -> BTB) (f id)
test (fun g -> fun n -> id)
//│ test: ((forall 'a. 'a -> 'a) -> anything -> BTB) -> anything -> BTB
//│ res: anything -> BTB


// * OK
def test f =
  (fun () -> f id)() : anything -> BTB
test (fun g -> fun n -> id)
//│ test: ((forall 'a. 'a -> 'a) -> anything -> BTB) -> anything -> BTB
//│ res: anything -> BTB


// * NOT OK: Notice the extruded skolem in `??b -> ??b0` whichb results from distributing 'b out of BTB
def test f =
  let a = f() in
  a : anything -> BTB
//│ test: (() -> anything -> BTB) -> anything -> BTB

:e
test (fun () -> fun n -> id)
//│ res: anything -> BTB


// * Idem
def test f =
  let a() = f id in
  a() : nothing -> BTB
//│ test: ((forall 'a. 'a -> 'a) -> nothing -> BTB) -> nothing -> BTB

:e
test (fun g -> fun n -> id)
//│ res: nothing -> BTB



:DontDistributeForalls


// * There is no longer an extruded skolem
def test f =
  let a = f() in
  a : anything -> BTB
//│ test: (() -> anything -> BTB) -> anything -> BTB

test (fun () -> fun n -> id)
//│ res: anything -> BTB


// * Idem
def test f =
  let a = f id in
  a : nothing -> BTB
//│ test: ((forall 'a. 'a -> 'a) -> nothing -> BTB) -> nothing -> BTB

test (fun g -> fun n -> id)
//│ res: nothing -> BTB



